<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Code Review Analysis ChecK</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/insights.css') }}">
</head>
<body>
    <div class="container">
        <!-- PR General Info -->
        <div class="pr-header">
            <div class="org-info">
                <img src="{{ org_logo }}" alt="Organization Logo" class="org-logo">
                <div class="org-details">
                    <h2>
                        <a href="{{ org_url }}" target="_blank">{{ org_name }}</a> / 
                        <a href="{{ repo_url }}" target="_blank">{{ repo_name }}</a>
                    </h2>
                    <p><strong>Pull Request #{{ pr_number }}:</strong> {{ pr_title }}</p>
                </div>
            </div>
            <a href="{{ pr_link }}" target="_blank" class="view-pr-link">View Pull Request</a>
        </div>

        <!-- PR Summary Display -->
        <div class="pr-summary-details">
            <h3>Summary of Changes</h3>
            <div>{{ pr_summary | safe }}</div> <!-- Display the pr_summary content here -->
        </div>

        <!-- File Changes Section -->
        <div class="file-changes">
            <h3>Files Changed</h3>
            {% for file in pr_files %}
                <div class="file-diff">
                    <h4>{{ file.filename }}</h4>
                    <p><strong>File Status:</strong>{{ file.status }}</p>
                    {% if file.status == "modified" %}
                    <p><strong>Additions:</strong>{{ file.additions }} 
                       <strong>Deletions:</strong>{{ file.deletions }} 
                       <strong>Changes:</strong>{{ file.changes }}</p>
                    {% endif %}
                    
                    <p><strong>Importance:</strong>
                        {% if file.importance_score | default(0) >= 7 %}High
                        {% elif file.importance_score | default(0) >= 4 %}Medium
                        {% else %}Low
                        {% endif %}
                    </p>
                    
                    {% if file.is_vulnerable %}
                        <div class="vulnerability-banner">
                            <strong>Vulnerability:</strong> {{ file.vulnerability_summary }}
                        </div>
                    {% endif %}
                    
                    {% if file.patch %}
                        <table class="diff-view">
                            <tbody>
                                {% for line in file.lines %}
                                    <tr class="diff-line {{ line.type }}">
                                        <td class="line-number">{{ line.old_line_num }}</td>
                                        <td class="line-number">{{ line.new_line_num }}</td>
                                        <td class="line-content">
                                            <span class="line-marker">
                                                {% if line.type == "addition" %}+{% elif line.type == "deletion" %}-{% else %} {% endif %}
                                            </span>
                                            {{ line.content[1:] }}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p class="no-diff">Diff not available for this file.</p>
                    {% endif %}
                </div>
                <hr>
            {% endfor %}
        </div>
    </div>
</body>
</html>
